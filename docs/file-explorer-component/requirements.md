# CASFA File Explorer ç»„ä»¶éœ€æ±‚æ–‡æ¡£

## 1. æ¦‚è¿°

### 1.1 ç›®æ ‡

æ„å»ºä¸€ä¸ªè‡ªåŒ…å«çš„ React æ–‡ä»¶æµè§ˆå™¨ç»„ä»¶ `<CasfaExplorer />`ï¼Œ**ä»…éœ€ä¼ å…¥ä¸€ä¸ªå·²åˆå§‹åŒ–çš„ `CasfaClient` å³å¯å·¥ä½œ**ã€‚ç»„ä»¶å°è£…æ‰€æœ‰æ–‡ä»¶ç³»ç»Ÿæ“ä½œé€»è¾‘ï¼ŒåŸºäº MUI å®ç° UIï¼Œå¯è·¨é¡¹ç›®å¤ç”¨ï¼ˆå‘å¸ƒä¸ºç‹¬ç«‹ npm åŒ… `@casfa/explorer`ï¼‰ã€‚

### 1.2 è®¾è®¡åŸåˆ™

- **æœ€å° props**: æ ¸å¿ƒåªéœ€ä¸€ä¸ª `CasfaClient` å®ä¾‹ã€‚Client å·²å°è£… serverUrlã€delegateã€token ç®¡ç†ï¼Œç»„ä»¶ä¸å…³å¿ƒè®¤è¯ç»†èŠ‚
- **Backend agnostic**: é€šè¿‡ `@casfa/client` SDK ä¸ä»»æ„ CASFA server é€šä¿¡
- **æƒé™æ„ŸçŸ¥**: æ ¹æ® delegate çš„æƒé™ï¼ˆscope / canUpload / canManageDepotï¼‰åŠ¨æ€éšè—/ç¦ç”¨ UI å…ƒç´ 
- **æ‡’åŠ è½½**: ç›®å½•æŒ‰éœ€å±•å¼€ï¼Œä¸é¢„åŠ è½½æ•´æ£µæ ‘
- **å¯ç»„åˆ**: æ ¸å¿ƒé€»è¾‘ä¸ UI åˆ†ç¦»ï¼Œæ”¯æŒ headless ä½¿ç”¨æˆ–è‡ªå®šä¹‰æ¸²æŸ“

### 1.3 å‘å¸ƒå½¢æ€

```
packages/explorer/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ core/           # headless çŠ¶æ€ç®¡ç† & API å±‚
â”‚   â”œâ”€â”€ components/     # MUI UI ç»„ä»¶
â”‚   â”œâ”€â”€ hooks/          # React hooks
â”‚   â”œâ”€â”€ types.ts        # å…¬å…±ç±»å‹
â”‚   â””â”€â”€ index.ts        # å…¥å£
â”œâ”€â”€ package.json        # peerDeps: react, @mui/material, @casfa/client
â””â”€â”€ tsconfig.json
```

---

## 2. ç»„ä»¶æ¥å£

### 2.1 æœ€å°ç”¨æ³•

```tsx
import { createClient } from "@casfa/client";
import { CasfaExplorer } from "@casfa/explorer";

// å®¿ä¸»åº”ç”¨è´Ÿè´£åˆ›å»ºå’Œç®¡ç† clientï¼ˆå« token åˆ·æ–°ï¼‰
const client = createClient({
  serverUrl: "https://casfa.example.com",
  accessToken: "AT_base64...",
  refreshToken: "RT_base64...",
});

// æœ€ç®€ï¼šåªä¼  clientï¼Œç»„ä»¶å†…éƒ¨æ˜¾ç¤º depot é€‰æ‹©å™¨
<CasfaExplorer client={client} />

// æŒ‡å®š depotï¼šè·³è¿‡é€‰æ‹©å™¨ï¼Œç›´æ¥è¿›å…¥æ–‡ä»¶æµè§ˆ
<CasfaExplorer client={client} depotId="dpt_XXXX" />
```

### 2.2 å®Œæ•´ Props

```ts
interface CasfaExplorerProps {
  // â”€â”€ è¿æ¥ï¼ˆå”¯ä¸€å¿…å¡«ï¼‰ â”€â”€
  client: CasfaClient;

  // â”€â”€ Depot â”€â”€
  depotId?: string;                // æŒ‡å®š depotã€‚çœç•¥æ—¶ç»„ä»¶æ˜¾ç¤ºå†…ç½® depot é€‰æ‹©å™¨
  onDepotChange?: (depotId: string) => void;  // depot åˆ‡æ¢å›è°ƒ

  // â”€â”€ åˆå§‹çŠ¶æ€ â”€â”€
  initialPath?: string;            // åˆå§‹æ‰“å¼€çš„ç›®å½•è·¯å¾„ï¼Œé»˜è®¤ ""ï¼ˆæ ¹ç›®å½•ï¼‰
  initialLayout?: "list" | "grid"; // é»˜è®¤è§†å›¾æ¨¡å¼

  // â”€â”€ å°ºå¯¸ â”€â”€
  height?: string | number;        // é»˜è®¤ "100%"
  width?: string | number;         // é»˜è®¤ "100%"

  // â”€â”€ æ‰©å±•ç‚¹ â”€â”€
  extraContextMenuItems?: ExplorerMenuItem[];   // è¿½åŠ è‡ªå®šä¹‰å³é”®èœå•é¡¹
  extraToolbarItems?: ExplorerToolbarItem[];     // è¿½åŠ è‡ªå®šä¹‰å·¥å…·æ æŒ‰é’®
  previewProviders?: PreviewProvider[];          // æŒ‰ content type æ‰©å±•æ–‡ä»¶é¢„è§ˆ

  // â”€â”€ äº‹ä»¶å›è°ƒ â”€â”€
  onNavigate?: (path: string) => void;
  onSelect?: (items: ExplorerItem[]) => void;
  onFileOpen?: (item: ExplorerItem) => void;
  onError?: (error: ExplorerError) => void;
  onRootChange?: (newRoot: string) => void;

  // â”€â”€ è‡ªå®šä¹‰æ¸²æŸ“ â”€â”€
  renderEmptyState?: () => React.ReactNode;
  renderBreadcrumb?: (segments: PathSegment[]) => React.ReactNode;
  renderNodeIcon?: (item: ExplorerItem) => React.ReactNode;

  // â”€â”€ ä¸»é¢˜ â”€â”€
  sx?: SxProps<Theme>;

  // â”€â”€ å›½é™…åŒ– â”€â”€
  locale?: string;                              // é»˜è®¤ "en-US"ï¼Œå†…ç½® "en-US" | "zh-CN"
  i18n?: (builtinT: ExplorerT) => ExplorerT;    // ä¿®é¥°å†…ç½®ç¿»è¯‘å‡½æ•°
}
```

### 2.3 æƒé™æ¨¡å‹

**ç»„ä»¶ä¸æ¥å—å‰ç«¯æƒé™è¦†ç›– propã€‚** æƒé™å®Œå…¨ç”± server ç«¯çš„ delegate å±æ€§å†³å®šï¼š

- `scope`ï¼ˆèŠ‚ç‚¹ hashï¼‰â†’ å†³å®šå¯æµè§ˆ/å¯è¯»çš„å­æ ‘èŒƒå›´
- `canUpload`ï¼ˆbooleanï¼‰â†’ å†³å®šæ‰€æœ‰å†™æ“ä½œï¼ˆåˆ›å»ºã€ä¸Šä¼ ã€é‡å‘½åã€ç§»åŠ¨ã€å¤åˆ¶ã€åˆ é™¤ï¼‰
- `canManageDepot`ï¼ˆbooleanï¼‰â†’ å†³å®š depot çº§åˆ«æ“ä½œï¼ˆåˆ›å»º/åˆ é™¤ depotã€commitï¼‰

ç»„ä»¶åœ¨é¦–æ¬¡åŠ è½½æ—¶é€šè¿‡ client æŸ¥è¯¢å½“å‰ delegate ä¿¡æ¯ï¼Œæ®æ­¤åŠ¨æ€æ˜¾ç¤º/éšè— UI å…ƒç´ ã€‚å†™æ“ä½œè¢« server æ‹’ç»ï¼ˆ403ï¼‰æ—¶ï¼Œç»„ä»¶æ›´æ–°æœ¬åœ°æƒé™çŠ¶æ€å¹¶ç»™å‡ºæç¤ºã€‚

> **ç†ç”±**ï¼šå‰ç«¯æ”¶çª„æƒé™æ— æ„ä¹‰ï¼ˆserver æœ¬æ¥å°±ä¼šæ‹’ç»ï¼‰ï¼›å‰ç«¯æ”¾å¤§æƒé™æ›´æ— æ„ä¹‰ï¼ˆserver ä¼š 403ï¼‰ã€‚æƒé™æ˜¯ server ç«¯äº‹å®ï¼Œä¸åº”ç”± prop é…ç½®ã€‚

### 2.4 å›½é™…åŒ–

#### æ ¸å¿ƒç¿»è¯‘å‡½æ•°

```ts
/**
 * ç¿»è¯‘å‡½æ•°ç­¾åã€‚ç»„ä»¶å†…éƒ¨æ‰€æœ‰ UI æ–‡æ¡ˆéƒ½é€šè¿‡æ­¤å‡½æ•°è·å–ã€‚
 *
 * @param key   - æ–‡æ¡ˆ keyï¼Œå¦‚ "toolbar.upload"ã€"dialog.confirmDelete.title"
 * @param args  - æ’å€¼å‚æ•°ï¼Œå¦‚ { count: 3 }
 * @returns ç¿»è¯‘åçš„å­—ç¬¦ä¸²
 */
type ExplorerT = (key: ExplorerTextKey, args?: Record<string, string | number>) => string;
```

#### å†…ç½®æ–‡æ¡ˆ

ç»„ä»¶å†…ç½® `en-US` å’Œ `zh-CN` ä¸¤å¥—å®Œæ•´æ–‡æ¡ˆï¼Œé€šè¿‡ `locale` prop é€‰æ‹©ï¼š

```ts
// å†…ç½® text key æšä¸¾ï¼ˆéƒ¨åˆ†ç¤ºä¾‹ï¼‰
type ExplorerTextKey =
  // å·¥å…·æ 
  | "toolbar.createFolder"       // "New Folder" / "æ–°å»ºæ–‡ä»¶å¤¹"
  | "toolbar.upload"             // "Upload" / "ä¸Šä¼ "
  | "toolbar.download"           // "Download" / "ä¸‹è½½"
  | "toolbar.delete"             // "Delete" / "åˆ é™¤"
  | "toolbar.rename"             // "Rename" / "é‡å‘½å"
  | "toolbar.refresh"            // "Refresh" / "åˆ·æ–°"
  | "toolbar.search"             // "Search files..." / "æœç´¢æ–‡ä»¶..."
  // å³é”®èœå•
  | "context.open"               // "Open" / "æ‰“å¼€"
  | "context.cut"                // "Cut" / "å‰ªåˆ‡"
  | "context.copy"               // "Copy" / "å¤åˆ¶"
  | "context.paste"              // "Paste" / "ç²˜è´´"
  | "context.copyCasUri"         // "Copy CAS URI" / "å¤åˆ¶ CAS URI"
  | "context.properties"         // "Properties" / "å±æ€§"
  // å¯¹è¯æ¡†
  | "dialog.confirmDelete.title" // "Confirm Delete" / "ç¡®è®¤åˆ é™¤"
  | "dialog.confirmDelete.body"  // "Delete {count} item(s)? This cannot be undone."
  | "dialog.newFolder.title"     // "New Folder" / "æ–°å»ºæ–‡ä»¶å¤¹"
  | "dialog.newFolder.placeholder" // "Folder name" / "æ–‡ä»¶å¤¹åç§°"
  | "dialog.rename.title"        // "Rename" / "é‡å‘½å"
  | "dialog.conflict.title"      // "Name Conflict" / "åç§°å†²çª"
  | "dialog.conflict.overwrite"  // "Overwrite" / "è¦†ç›–"
  | "dialog.conflict.rename"     // "Rename" / "é‡å‘½å"
  | "dialog.conflict.skip"       // "Skip" / "è·³è¿‡"
  // çŠ¶æ€
  | "status.emptyFolder"         // "This folder is empty" / "æ­¤æ–‡ä»¶å¤¹ä¸ºç©º"
  | "status.dropFiles"           // "Drop files here to upload" / "æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„ä¸Šä¼ "
  | "status.uploadSuccess"       // "Uploaded {count} file(s)" / "å·²ä¸Šä¼  {count} ä¸ªæ–‡ä»¶"
  | "status.deleteSuccess"       // "Deleted {count} item(s)" / "å·²åˆ é™¤ {count} ä¸ªé¡¹ç›®"
  // é”™è¯¯
  | "error.network"              // "Network unavailable" / "ç½‘ç»œä¸å¯ç”¨"
  | "error.permissionDenied"     // "Permission denied" / "æƒé™ä¸è¶³"
  | "error.fileTooLarge"         // "File too large (max 4MB)" / "æ–‡ä»¶è¿‡å¤§ï¼ˆæœ€å¤§ 4MBï¼‰"
  | "error.authExpired"          // "Session expired, please log in again" / "è®¤è¯å·²è¿‡æœŸ"
  // Depot
  | "depot.select"               // "Select Depot" / "é€‰æ‹©ä»“åº“"
  | "depot.empty"                // "No depots available" / "æš‚æ— å¯ç”¨ä»“åº“"
  ;
```

#### ä¿®é¥°å‡½æ•°ï¼ˆ`i18n` propï¼‰

å®¿ä¸»åº”ç”¨é€šè¿‡ `i18n` prop ä¼ å…¥ä¸€ä¸ª**ä¿®é¥°å‡½æ•°**ï¼Œå¯¹å†…ç½®ç¿»è¯‘å‡½æ•°è¿›è¡ŒåŒ…è£…ï¼š

```tsx
// ç”¨æ³• 1ï¼šè¦†ç›–ä¸ªåˆ« key
<CasfaExplorer
  client={client}
  locale="en-US"
  i18n={(builtinT) => (key, args) => {
    // è‡ªå®šä¹‰ä¸ªåˆ«æ–‡æ¡ˆ
    if (key === "toolbar.upload") return "Import Files";
    if (key === "depot.select") return "Choose Repository";
    // å…¶ä½™ fallback åˆ°å†…ç½®ç¿»è¯‘
    return builtinT(key, args);
  }}
/>

// ç”¨æ³• 2ï¼šæ¥å…¥å®¿ä¸»åº”ç”¨çš„ i18n æ¡†æ¶ï¼ˆå¦‚ i18nextï¼‰
<CasfaExplorer
  client={client}
  i18n={(builtinT) => (key, args) => {
    // ä¼˜å…ˆä½¿ç”¨å®¿ä¸» i18nï¼Œæ‰¾ä¸åˆ°åˆ™ fallback
    const hostResult = hostI18n.t(`explorer.${key}`, args);
    return hostResult !== `explorer.${key}` ? hostResult : builtinT(key, args);
  }}
/>

// ç”¨æ³• 3ï¼šä¸ä¼  i18n â€” ç›´æ¥ä½¿ç”¨ locale å¯¹åº”çš„å†…ç½®æ–‡æ¡ˆ
<CasfaExplorer client={client} locale="zh-CN" />
```

**è®¾è®¡è¦ç‚¹**ï¼š
- ç»„ä»¶å…ˆæ ¹æ® `locale` æ„å»ºå†…ç½® `builtinT`ï¼Œå†ç”¨ `i18n` ä¿®é¥°å®ƒ
- ä¿®é¥°å‡½æ•°è¿”å›ä¸€ä¸ªæ–°çš„ `ExplorerT`ï¼Œæ‹¥æœ‰å®Œå…¨æ§åˆ¶æƒ
- ä¸ä¼  `i18n` æ—¶ `builtinT` ç›´æ¥ä½¿ç”¨ï¼Œé›¶é…ç½®å³å¯å·¥ä½œ

### 2.5 æ–‡ä»¶é¢„è§ˆæ‰©å±•

æ–‡ä»¶é¢„è§ˆåŸºäº **content type åŒ¹é…**ï¼Œæ”¯æŒæŒ‰ç±»å‹æ³¨å†Œè‡ªå®šä¹‰é¢„è§ˆå™¨ï¼Œä¸å½±å“å…¶ä»–ç±»å‹çš„å†…ç½®é¢„è§ˆã€‚

```ts
interface PreviewProvider {
  /**
   * åˆ¤æ–­æ­¤ provider æ˜¯å¦å¤„ç†è¯¥æ–‡ä»¶ã€‚
   * å¯æŒ‰ contentType ç²¾ç¡®åŒ¹é…ï¼Œä¹Ÿå¯æŒ‰å‰ç¼€/é€šé…åŒ¹é…ã€‚
   */
  match: (file: ExplorerItem) => boolean;

  /**
   * æ¸²æŸ“é¢„è§ˆå†…å®¹ã€‚æ¥æ”¶æ–‡ä»¶å…ƒæ•°æ®å’Œå·²åŠ è½½çš„å†…å®¹ï¼ˆBlobï¼‰ã€‚
   */
  render: (file: ExplorerItem, content: Blob) => React.ReactNode;

  /**
   * å¯é€‰ï¼šé¢„è§ˆé¢æ¿ä¸­æ˜¾ç¤ºçš„æ ‡ç­¾åï¼ˆå¦‚ "Markdown"ã€"3D Model"ï¼‰ã€‚
   */
  label?: string;
}
```

**åŒ¹é…ä¼˜å…ˆçº§**ï¼š`previewProviders` æ•°ç»„æŒ‰é¡ºåºåŒ¹é…ï¼Œç¬¬ä¸€ä¸ª `match` è¿”å› `true` çš„ provider ç”Ÿæ•ˆã€‚è‹¥æ— åŒ¹é…ï¼Œfallback åˆ°å†…ç½®é¢„è§ˆå™¨ã€‚å†…ç½®é¢„è§ˆå™¨ä»æ— æ³•å¤„ç†æ—¶ï¼Œæ˜¾ç¤º"ä¸æ”¯æŒé¢„è§ˆ"æç¤ºã€‚

**å†…ç½®é¢„è§ˆå™¨**ï¼ˆä¼˜å…ˆçº§æœ€ä½ï¼Œä½œä¸º fallbackï¼‰ï¼š

| Content Type | é¢„è§ˆæ–¹å¼ |
|-------------|---------|
| `image/*` | `<img>` æ ‡ç­¾ |
| `text/*` | çº¯æ–‡æœ¬æ¸²æŸ“ï¼ˆç­‰å®½å­—ä½“ã€è¡Œå·ï¼‰ |
| `audio/*` | HTML5 `<audio>` æ’­æ”¾å™¨ |
| `video/*` | HTML5 `<video>` æ’­æ”¾å™¨ |
| å…¶ä»– | æ˜¾ç¤ºæ–‡ä»¶å…ƒæ•°æ® + "ä¸æ”¯æŒé¢„è§ˆ" æç¤º |

**ç”¨æ³•ç¤ºä¾‹**ï¼š

```tsx
import { CasfaExplorer } from "@casfa/explorer";
import { MarkdownPreview } from "./my-markdown-preview";
import { ThreeDViewer } from "./my-3d-viewer";

<CasfaExplorer
  client={client}
  previewProviders={[
    // Markdownï¼šè¦†ç›–å†…ç½®çš„ text/* é¢„è§ˆ
    {
      match: (file) => file.contentType === "text/markdown",
      render: (file, blob) => <MarkdownPreview blob={blob} />,
      label: "Markdown",
    },
    // 3D æ¨¡å‹ï¼šæ–°å¢å†…ç½®ä¸æ”¯æŒçš„ç±»å‹
    {
      match: (file) => file.contentType === "model/gltf-binary",
      render: (file, blob) => <ThreeDViewer blob={blob} />,
      label: "3D Model",
    },
    // æŒ‰æ–‡ä»¶æ‰©å±•ååŒ¹é…ï¼ˆmatch å¯ä»¥ç”¨ä»»æ„é€»è¾‘ï¼‰
    {
      match: (file) => file.name.endsWith(".csv"),
      render: (file, blob) => <CsvTable blob={blob} />,
      label: "CSV",
    },
  ]}
/>
```

---

## 3. ç”¨ä¾‹

### 3.1 æµè§ˆä¸å¯¼èˆª

| # | ç”¨ä¾‹ | æè¿° |
|---|------|------|
| B-1 | **ç›®å½•æµè§ˆ** | æ‰“å¼€ä¸€ä¸ªç›®å½•ï¼Œæ˜¾ç¤ºå…¶å­é¡¹ï¼ˆæ–‡ä»¶ + å­æ–‡ä»¶å¤¹ï¼‰ï¼ŒæŒ‰åç§°æ’åºï¼Œæ–‡ä»¶å¤¹åœ¨å‰ |
| B-2 | **æ‡’åŠ è½½å±•å¼€** | ç‚¹å‡»æ–‡ä»¶å¤¹æ—¶æŒ‰éœ€è°ƒç”¨ `fs/ls`ï¼Œä¸é¢„åŠ è½½æ•´æ£µæ ‘ |
| B-3 | **åˆ†é¡µåŠ è½½** | ç›®å½•å­é¡¹è¶…è¿‡å•é¡µï¼ˆé»˜è®¤ 200ï¼‰æ—¶ï¼Œæ»šåŠ¨åˆ°åº•éƒ¨è‡ªåŠ¨åŠ è½½ä¸‹ä¸€é¡µï¼ˆcursor-basedï¼‰ |
| B-4 | **é¢åŒ…å±‘å¯¼èˆª** | æ˜¾ç¤ºå½“å‰è·¯å¾„çš„é¢åŒ…å±‘ï¼Œç‚¹å‡»ä»»æ„å±‚çº§å¯è·³è½¬ |
| B-5 | **æ ‘å½¢ä¾§è¾¹æ ** | å¯æŠ˜å çš„å·¦ä¾§ç›®å½•æ ‘ï¼Œåªå±•ç¤ºæ–‡ä»¶å¤¹ï¼Œç‚¹å‡»åˆ‡æ¢ä¸»é¢æ¿ç›®å½• |
| B-6 | **å‰è¿›/åé€€** | ç»´æŠ¤å¯¼èˆªå†å²æ ˆï¼Œæ”¯æŒå‰è¿›/åé€€æŒ‰é’®å’Œæµè§ˆå™¨å¿«æ·é”® |
| B-7 | **è·¯å¾„è¾“å…¥** | ç‚¹å‡»é¢åŒ…å±‘å¯åˆ‡æ¢ä¸ºæ–‡æœ¬è¾“å…¥æ¡†ï¼Œç›´æ¥è¾“å…¥è·¯å¾„è·³è½¬ |
| B-8 | **List / Grid åˆ‡æ¢** | åˆ—è¡¨è§†å›¾ï¼ˆè¯¦æƒ…åˆ—ï¼‰å’Œç½‘æ ¼è§†å›¾ï¼ˆå›¾æ ‡ç¼©ç•¥å›¾ï¼‰ä¹‹é—´åˆ‡æ¢ |
| B-9 | **åˆ—æ’åº** | List view ä¸‹ç‚¹å‡»åˆ—å¤´ï¼ˆåç§° / å¤§å° / ç±»å‹ / ä¿®æ”¹æ—¶é—´ï¼‰æ’åº |
| B-10 | **æœç´¢è¿‡æ»¤** | å·¥å…·æ æœç´¢æ¡†ï¼Œå‰ç«¯è¿‡æ»¤å½“å‰ç›®å½•ä¸‹å·²åŠ è½½çš„é¡¹ç›®åç§° |

### 3.2 æ–‡ä»¶æ“ä½œ â€” è¯»å–

| # | ç”¨ä¾‹ | æè¿° |
|---|------|------|
| R-1 | **æ–‡ä»¶è¯¦æƒ…é¢æ¿** | é€‰ä¸­æ–‡ä»¶ååœ¨å³ä¾§æµ®åŠ¨é¢æ¿æ˜¾ç¤ºå…ƒæ•°æ®ï¼šåç§°ã€å¤§å°ã€å†…å®¹ç±»å‹ã€CAS hashã€åˆ›å»ºæ—¶é—´ |
| R-2 | **æ–‡ä»¶é¢„è§ˆ** | åŒå‡»æ–‡ä»¶æ‰“å¼€é¢„è§ˆé¢æ¿ã€‚å†…ç½®æ”¯æŒï¼šå›¾ç‰‡ï¼ˆimg tagï¼‰ã€æ–‡æœ¬ï¼ˆçº¯æ–‡æœ¬æ¸²æŸ“ï¼‰ã€éŸ³è§†é¢‘ï¼ˆHTML5 playerï¼‰ã€‚å¯é€šè¿‡ `previewProviders` æŒ‰ content type æ‰©å±•æˆ–è¦†ç›–é¢„è§ˆå™¨ï¼ˆè§ 2.5ï¼‰ |
| R-3 | **æ–‡ä»¶ä¸‹è½½** | å·¥å…·æ æŒ‰é’® / å³é”®èœå• / å¿«æ·é”®ä¸‹è½½é€‰ä¸­æ–‡ä»¶ã€‚è°ƒç”¨ `fs/read` è·å– blob å¹¶è§¦å‘æµè§ˆå™¨ä¸‹è½½ |
| R-4 | **æ‰¹é‡ä¸‹è½½** | é€‰ä¸­å¤šä¸ªæ–‡ä»¶æ—¶ï¼Œé€ä¸ªä¸‹è½½æˆ–æ‰“åŒ…ä¸º zipï¼ˆå‰ç«¯ JSZipï¼‰|

### 3.3 æ–‡ä»¶æ“ä½œ â€” å†™å…¥

| # | ç”¨ä¾‹ | æè¿° |
|---|------|------|
| W-1 | **åˆ›å»ºæ–‡ä»¶å¤¹** | å·¥å…·æ  "æ–°å»ºæ–‡ä»¶å¤¹" æŒ‰é’® â†’ å¼¹å‡ºå‘½åå¯¹è¯æ¡† â†’ `fs/mkdir` |
| W-2 | **ä¸Šä¼ æ–‡ä»¶** | å·¥å…·æ  "ä¸Šä¼ " æŒ‰é’® â†’ æ‰“å¼€æ–‡ä»¶é€‰æ‹©å™¨ â†’ `fs/write` é€ä¸€ä¸Šä¼ ã€‚æ”¯æŒå¤šæ–‡ä»¶ |
| W-3 | **æ‹–æ‹½ä¸Šä¼ ** | ä»æ¡Œé¢æ‹–æ‹½æ–‡ä»¶/æ–‡ä»¶å¤¹åˆ°æµè§ˆåŒºåŸŸè§¦å‘ä¸Šä¼ ï¼Œå« drop zone è§†è§‰åé¦ˆ |
| W-4 | **ä¸Šä¼ è¿›åº¦** | æ˜¾ç¤ºæ¯ä¸ªæ–‡ä»¶çš„ä¸Šä¼ çŠ¶æ€ï¼ˆç­‰å¾…ä¸­ / ä¸Šä¼ ä¸­ / æˆåŠŸ / å¤±è´¥ï¼‰å’Œæ•´ä½“è¿›åº¦æ¡ |
| W-5 | **å¤§å°é™åˆ¶æç¤º** | è¶…è¿‡ 4MB çš„æ–‡ä»¶ç»™å‡ºæ˜ç¡®é”™è¯¯æç¤ºï¼ˆå½“å‰ single-block é™åˆ¶ï¼‰ |
| W-6 | **é‡åå†²çªå¤„ç†** | ä¸Šä¼ /ç§»åŠ¨æ—¶ç›®æ ‡å·²å­˜åœ¨åŒåæ–‡ä»¶ï¼šæç¤ºè¦†ç›– / é‡å‘½å / è·³è¿‡ |
| W-7 | **é‡å‘½å** | é€‰ä¸­æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ â†’ F2 / å³é”®"é‡å‘½å" â†’ å†…è”ç¼–è¾‘ â†’ `fs/mv` |
| W-8 | **åˆ é™¤** | é€‰ä¸­é¡¹ â†’ Delete é”® / å³é”®"åˆ é™¤" â†’ ç¡®è®¤å¯¹è¯æ¡† â†’ `fs/rm`ã€‚æ”¯æŒæ‰¹é‡ |
| W-9 | **ç§»åŠ¨** | æ‹–æ‹½æ–‡ä»¶åˆ°ç›®æ ‡æ–‡ä»¶å¤¹ / å‰ªåˆ‡+ç²˜è´´ â†’ `fs/mv` |
| W-10 | **å¤åˆ¶** | Ctrl+C / å³é”®"å¤åˆ¶" â†’ Ctrl+V / å³é”®"ç²˜è´´" â†’ `fs/cp`ï¼ˆCAS é›¶æ‹·è´ï¼‰|
| W-11 | **åŸå­æ‰¹é‡æ“ä½œ** | å¤šä¸ªæ“ä½œåˆå¹¶ä¸ºä¸€æ¬¡ `fs/rewrite` è°ƒç”¨ï¼ˆæœ€å¤š 100 entriesï¼‰ï¼Œå‡å°‘ commit æ¬¡æ•° |

### 3.4 é€‰æ‹©ä¸äº¤äº’

| # | ç”¨ä¾‹ | æè¿° |
|---|------|------|
| S-1 | **å•é€‰** | ç‚¹å‡»é€‰ä¸­å•ä¸ªé¡¹ |
| S-2 | **å¤šé€‰** | Ctrl+Click åˆ‡æ¢é€‰ä¸­ï¼ŒShift+Click èŒƒå›´é€‰ä¸­ |
| S-3 | **å…¨é€‰** | Ctrl+A é€‰ä¸­å½“å‰ç›®å½•æ‰€æœ‰é¡¹ |
| S-4 | **å³é”®èœå•** | å³é”®å¼¹å‡ºä¸Šä¸‹æ–‡èœå•ï¼Œæ ¹æ®é€‰ä¸­é¡¹ç±»å‹å’Œæƒé™åŠ¨æ€ç”Ÿæˆèœå•é¡¹ |
| S-5 | **æ‹–æ‹½ç§»åŠ¨** | åœ¨æ ‘å†…æ‹–æ‹½æ–‡ä»¶/æ–‡ä»¶å¤¹åˆ°ç›®æ ‡ç›®å½• |
| S-6 | **æ‹–æ‹½æ’åºåé¦ˆ** | æ‹–æ‹½æ—¶é«˜äº®æœ‰æ•ˆ drop targetï¼Œæ— æ•ˆç›®æ ‡æ˜¾ç¤ºç¦æ­¢å›¾æ ‡ |
| S-7 | **é”®ç›˜å¯¼èˆª** | â†‘â†“ é€‰æ‹©ã€Enter æ‰“å¼€ã€Backspace ä¸Šçº§ã€Delete åˆ é™¤ã€F2 é‡å‘½å |

### 3.5 CAS ç‰¹æœ‰åŠŸèƒ½

| # | ç”¨ä¾‹ | æè¿° |
|---|------|------|
| C-1 | **æ˜¾ç¤º CAS Hash** | æ–‡ä»¶è¯¦æƒ…é¢æ¿æ˜¾ç¤ºèŠ‚ç‚¹çš„ `nod_XXXX` æ ‡è¯†ç¬¦ |
| C-2 | **CAS URI å¤åˆ¶** | å³é”® "å¤åˆ¶ CAS URI" â†’ ç”Ÿæˆ `nod_XXXX/path#index` æ ¼å¼çš„ URI åˆ°å‰ªè´´æ¿ |
| C-3 | **Root è¿½è¸ª** | æ¯æ¬¡å†™æ“ä½œåæ˜¾ç¤ºæ–° root hashï¼ŒçŠ¶æ€æ æ˜¾ç¤ºå½“å‰ depot root |
| C-3.5 | **Depot é€‰æ‹©å™¨** | æœªæŒ‡å®š `depotId` æ—¶ï¼Œç»„ä»¶é¦–å±æ˜¾ç¤º depot åˆ—è¡¨ï¼ˆå¡ç‰‡/åˆ—è¡¨ï¼‰ï¼Œç”¨æˆ·é€‰æ‹©åè¿›å…¥æ–‡ä»¶æµè§ˆã€‚æ”¯æŒæœç´¢ã€æ˜¾ç¤º depot åç§°å’Œ ID |
| C-4 | **Depot å†å²** | æŸ¥çœ‹å½“å‰ depot çš„ root historyï¼ˆæœ€è¿‘ N æ¬¡ commitï¼‰ï¼Œæ”¯æŒå›æ»šåˆ°å†å²ç‰ˆæœ¬æµè§ˆ |
| C-5 | **Content å»é‡æŒ‡ç¤º** | å¯¹äº CAS ç›¸åŒ hash çš„æ–‡ä»¶ï¼Œåœ¨ UI ä¸Šæ ‡æ³¨ï¼ˆä¾‹å¦‚å¤åˆ¶åçš„æ–‡ä»¶æ˜¾ç¤º "é›¶æ‹·è´" badgeï¼‰ |
| C-6 | **Index Path é€ä¼ ** | è¯»å–æ“ä½œè‡ªåŠ¨é™„åŠ  `X-CAS-Index-Path` å¤´ï¼Œå¯¹å¼€å‘è€…é€æ˜ |

### 3.6 æƒé™ä¸å®‰å…¨

| # | ç”¨ä¾‹ | æè¿° |
|---|------|------|
| P-1 | **åªè¯»æ¨¡å¼** | delegate æ—  `canUpload` æ—¶ï¼Œæ‰€æœ‰å†™æ“ä½œ UI è‡ªåŠ¨éšè—/ç¦ç”¨ |
| P-2 | **Scope é™åˆ¶** | delegate çš„ scope é™å®šäº†å¯è®¿é—®çš„å­æ ‘ï¼Œè¶…å‡ºèŒƒå›´çš„èŠ‚ç‚¹ä¸å¯è®¿é—®ï¼Œå¯¼èˆªæ—¶å‹å¥½æç¤º |
| P-3 | **Token è‡ªåŠ¨åˆ·æ–°** | Access Token è¿‡æœŸæ—¶è‡ªåŠ¨é€šè¿‡ Refresh Token ç»­æœŸï¼Œå¯¹ç”¨æˆ·é€æ˜ |
| P-4 | **Token è¿‡æœŸå¤„ç†** | Refresh Token ä¹Ÿè¿‡æœŸæ—¶ï¼Œè§¦å‘ `onError` å›è°ƒï¼ˆtype: "auth_expired"ï¼‰ï¼Œå®¿ä¸»åº”ç”¨å†³å®šå¦‚ä½•å¤„ç†ï¼ˆå¦‚é‡æ–°ç™»å½•ï¼‰ |
| P-5 | **æ“ä½œç²’åº¦æƒé™** | å†™æ“ä½œå¤±è´¥ï¼ˆ403ï¼‰æ—¶æ˜¾ç¤ºæ˜ç¡®çš„æƒé™ä¸è¶³æç¤º |

### 3.7 ç”¨æˆ·ä½“éªŒ

| # | ç”¨ä¾‹ | æè¿° |
|---|------|------|
| U-1 | **åŠ è½½æ€** | ç›®å½•åŠ è½½ã€æ–‡ä»¶æ“ä½œä¸­æ˜¾ç¤º skeleton / spinner |
| U-2 | **ç©ºç›®å½•çŠ¶æ€** | ç©ºæ–‡ä»¶å¤¹æ˜¾ç¤ºå¼•å¯¼æ–‡æ¡ˆå’Œ"ä¸Šä¼ æ–‡ä»¶"/"æ–°å»ºæ–‡ä»¶å¤¹"å¿«æ·å…¥å£ |
| U-3 | **é”™è¯¯å¤„ç†** | ç½‘ç»œé”™è¯¯ã€æƒé™é”™è¯¯ã€æ–‡ä»¶è¿‡å¤§ç­‰ç»Ÿä¸€çš„é”™è¯¯ Snackbar æç¤º |
| U-4 | **æ“ä½œç¡®è®¤** | åˆ é™¤ç­‰å±é™©æ“ä½œå¼¹å‡ºç¡®è®¤å¯¹è¯æ¡† |
| U-5 | **æ’¤é”€æç¤º** | åˆ é™¤åæ˜¾ç¤º "å·²åˆ é™¤ X é¡¹" Snackbar å¹¶é™„å¸¦"æ’¤é”€"æŒ‰é’®ï¼ˆåœ¨ commit å‰å¯æ¢å¤ï¼‰ |
| U-6 | **å“åº”å¼å¸ƒå±€** | é€‚é…æ¡Œé¢å’Œå¹³æ¿å®½åº¦ã€‚ç§»åŠ¨ç«¯éšè—ä¾§è¾¹æ ï¼Œå·¥å…·æ æŠ˜å ä¸º overflow menu |
| U-7 | **æš—è‰²æ¨¡å¼** | è·Ÿéš MUI theme çš„ `palette.mode` |
| U-8 | **æ— éšœç¢** | ARIA æ ‡ç­¾ã€é”®ç›˜ç„¦ç‚¹ç®¡ç†ã€å±å¹•é˜…è¯»å™¨æ”¯æŒ |
| U-9 | **å›½é™…åŒ–** | æ‰€æœ‰ UI æ–‡æ¡ˆå¯é€šè¿‡ `messages` prop è¦†ç›–ï¼Œå†…ç½® en-US / zh-CN |

---

## 4. UI å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Toolbar                                                                      â”‚
â”‚ [â† â†’] [â†‘] ğŸ“ Home / Documents / Project         ğŸ” [âŠ][â‰¡] [â„¹ï¸] [âš™]      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Tree Sidebar â”‚ Main Panel                     â”‚ Detail / Preview Panel  [âœ•]  â”‚
â”‚              â”‚                                â”‚                              â”‚
â”‚ ğŸ“ Home     â”‚  Name        Size   Type  Mod  â”‚ ğŸ“„ README.md                 â”‚
â”‚  â”œâ”€ ğŸ“ Docs â”‚  ğŸ“ src      â€”     Dir   2h   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  â”‚  â”œâ”€ ğŸ“ P â”‚  ğŸ“ docs     â€”     Dir   1d   â”‚ Size: 2.1 KB                 â”‚
â”‚  â”‚  â””â”€ ğŸ“ A â”‚  ğŸ“„ README   2.1K  md    3h   â”‚ Type: text/markdown          â”‚
â”‚  â”œâ”€ ğŸ“ Pics â”‚  ğŸ–¼ logo    48K   img   5d   â”‚ Hash: nod_3FG7K...           â”‚
â”‚  â””â”€ ğŸ“ Musicâ”‚                                â”‚                              â”‚
â”‚              â”‚                                â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚              â”‚                                â”‚ â”‚  Preview                 â”‚ â”‚
â”‚              â”‚                                â”‚ â”‚  # README                â”‚ â”‚
â”‚              â”‚                                â”‚ â”‚  This is the project...  â”‚ â”‚
â”‚              â”‚                                â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Status Bar: Root: nod_7X2M... â”‚ 142 items â”‚ 3 selected                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.1 åŒºåŸŸè¯´æ˜

| åŒºåŸŸ | å†…å®¹ |
|------|------|
| **Toolbar** | å¯¼èˆªæŒ‰é’®ï¼ˆåé€€/å‰è¿›/ä¸Šçº§ï¼‰ã€é¢åŒ…å±‘ã€æœç´¢æ¡†ã€è§†å›¾åˆ‡æ¢ï¼ˆList/Gridï¼‰ã€æ“ä½œæŒ‰é’®ï¼ˆæ–°å»º/ä¸Šä¼ /ä¸‹è½½/åˆ é™¤ï¼‰ã€è®¾ç½® |
| **Tree Sidebar** | å¯æŠ˜å ã€‚ä»…æ˜¾ç¤ºæ–‡ä»¶å¤¹çš„æ ‘å½¢ç»“æ„ï¼Œæ‡’åŠ è½½ã€‚ç‚¹å‡»åˆ‡æ¢ä¸»é¢æ¿ã€‚å½“å‰ç›®å½•é«˜äº® |
| **Main Panel** | List view: å¯æ’åºæ•°æ®è¡¨æ ¼ã€‚Grid view: å›¾æ ‡/ç¼©ç•¥å›¾å¡ç‰‡ç½‘æ ¼ã€‚æ”¯æŒè™šæ‹Ÿæ»šåŠ¨ |
| **Detail Panel** | å³ä¾§æµ®åŠ¨é¢æ¿ï¼Œå¯é€šè¿‡å·¥å…·æ  â„¹ï¸ æŒ‰é’®æˆ–å¿«æ·é”®åˆ‡æ¢æ˜¾éšã€‚ä¸ŠåŠéƒ¨åˆ†æ˜¾ç¤ºé€‰ä¸­é¡¹å…ƒæ•°æ®ï¼Œä¸‹åŠéƒ¨åˆ†æ˜¾ç¤ºæ–‡ä»¶é¢„è§ˆï¼ˆå›¾ç‰‡/æ–‡æœ¬/PDF ç­‰ï¼‰ã€‚æœªé€‰ä¸­æ–‡ä»¶æ—¶è‡ªåŠ¨éšè— |
| **Status Bar** | å½“å‰ depot root hashã€ç›®å½•é¡¹æ•°ç»Ÿè®¡ã€é€‰ä¸­æ•°é‡ |

---

## 5. é”®ç›˜å¿«æ·é”®

| å¿«æ·é”® | æ“ä½œ |
|--------|------|
| `â†‘` / `â†“` | ä¸Šä¸‹ç§»åŠ¨ç„¦ç‚¹ |
| `Enter` | æ‰“å¼€æ–‡ä»¶/è¿›å…¥æ–‡ä»¶å¤¹ |
| `Backspace` | è¿”å›ä¸Šçº§ç›®å½• |
| `Delete` | åˆ é™¤é€‰ä¸­é¡¹ |
| `F2` | é‡å‘½å |
| `Ctrl+C` | å¤åˆ¶ |
| `Ctrl+X` | å‰ªåˆ‡ |
| `Ctrl+V` | ç²˜è´´ |
| `Ctrl+A` | å…¨é€‰ |
| `Ctrl+D` | ä¸‹è½½ |
| `Ctrl+Shift+N` | æ–°å»ºæ–‡ä»¶å¤¹ |
| `Ctrl+U` | ä¸Šä¼ æ–‡ä»¶ |
| `Ctrl+F` | èšç„¦æœç´¢æ¡† |
| `Ctrl+Shift+1` | åˆ‡æ¢åˆ—è¡¨è§†å›¾ |
| `Ctrl+Shift+2` | åˆ‡æ¢ç½‘æ ¼è§†å›¾ |
| `Esc` | å–æ¶ˆé€‰æ‹© / å…³é—­é¢æ¿ |
| `F5` | åˆ·æ–°å½“å‰ç›®å½• |

---

## 6. å³é”®èœå•

### 6.1 æ–‡ä»¶å³é”®

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“‹ æ‰“å¼€                â”‚
â”‚ ğŸ“‹ åœ¨æ–°æ ‡ç­¾é¡µæ‰“å¼€é¢„è§ˆ   â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ âœ‚ï¸ å‰ªåˆ‡          Ctrl+X â”‚
â”‚ ğŸ“‹ å¤åˆ¶          Ctrl+C â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ âœï¸ é‡å‘½å         F2    â”‚
â”‚ ğŸ—‘ åˆ é™¤          Delete â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ â¬‡ï¸ ä¸‹è½½          Ctrl+D â”‚
â”‚ ğŸ”— å¤åˆ¶ CAS URI        â”‚
â”‚ â„¹ï¸ å±æ€§                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 æ–‡ä»¶å¤¹å³é”®

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“‚ æ‰“å¼€                â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ âœ‚ï¸ å‰ªåˆ‡          Ctrl+X â”‚
â”‚ ğŸ“‹ å¤åˆ¶          Ctrl+C â”‚
â”‚ ğŸ“‹ ç²˜è´´          Ctrl+V â”‚  â† ä»…å‰ªè´´æ¿æœ‰å†…å®¹æ—¶æ˜¾ç¤º
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ âœï¸ é‡å‘½å         F2    â”‚
â”‚ ğŸ—‘ åˆ é™¤          Delete â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ ğŸ“ æ–°å»ºæ–‡ä»¶å¤¹          â”‚
â”‚ â¬†ï¸ ä¸Šä¼ åˆ°æ­¤ç›®å½•         â”‚
â”‚ ğŸ”— å¤åˆ¶ CAS URI        â”‚
â”‚ â„¹ï¸ å±æ€§                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.3 ç©ºç™½åŒºåŸŸå³é”®

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“‹ ç²˜è´´          Ctrl+V â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ ğŸ“ æ–°å»ºæ–‡ä»¶å¤¹          â”‚
â”‚ â¬†ï¸ ä¸Šä¼ æ–‡ä»¶            â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ ğŸ”„ åˆ·æ–°           F5   â”‚
â”‚ â„¹ï¸ æ–‡ä»¶å¤¹å±æ€§          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

> æ‰€æœ‰å†™æ“ä½œèœå•é¡¹åœ¨åªè¯»æ¨¡å¼ä¸‹è‡ªåŠ¨éšè—ã€‚è‡ªå®šä¹‰èœå•é¡¹é€šè¿‡ `extraContextMenuItems` æ³¨å…¥ã€‚

---

## 7. é”™è¯¯åœºæ™¯

| åœºæ™¯ | å¤„ç†æ–¹å¼ |
|------|---------|
| ç½‘ç»œæ–­å¼€ | Snackbar æç¤º "ç½‘ç»œä¸å¯ç”¨"ï¼Œæ“ä½œæ’é˜Ÿç­‰å¾…æ¢å¤ |
| Access Token è¿‡æœŸ | è‡ªåŠ¨é€šè¿‡ RT åˆ·æ–°ï¼Œæ— æ„ŸçŸ¥ |
| Refresh Token è¿‡æœŸ | è§¦å‘ `onError({ type: "auth_expired" })`ï¼Œæš‚åœæ“ä½œ |
| 403 æƒé™ä¸è¶³ | Snackbar æç¤ºå…·ä½“ç¼ºå°‘çš„æƒé™ |
| 404 è·¯å¾„ä¸å­˜åœ¨ | è‡ªåŠ¨è·³è½¬åˆ°æœ€è¿‘çš„æœ‰æ•ˆçˆ¶ç›®å½• |
| æ–‡ä»¶è¿‡å¤§ï¼ˆ>4MBï¼‰ | é€‰æ‹©æ–‡ä»¶æ—¶ç«‹å³æç¤ºï¼Œä¸å‘é€è¯·æ±‚ |
| æ–‡ä»¶åéæ³• | è¾“å…¥æ—¶å®æ—¶æ ¡éªŒï¼Œæ˜¾ç¤ºè¡Œå†…é”™è¯¯æç¤º |
| åç§°å†²çª | å¼¹å‡ºå¯¹è¯æ¡†ï¼šè¦†ç›– / é‡å‘½å / è·³è¿‡ |
| ç›®å½•å­é¡¹è¶…é™ï¼ˆ>10,000ï¼‰| æç¤º "æ­¤ç›®å½•åŒ…å«è¿‡å¤šå­é¡¹" |
| å¹¶å‘å†²çªï¼ˆroot å·²å˜æ›´ï¼‰| æç¤º "ç›®å½•å·²è¢«å…¶ä»–æ“ä½œä¿®æ”¹"ï¼Œæä¾›åˆ·æ–°é€‰é¡¹ |

---

## 8. æŠ€æœ¯é€‰å‹

| å±‚é¢ | é€‰æ‹© | ç†ç”± |
|------|------|------|
| UI æ¡†æ¶ | MUI v6 (`@mui/material`) | é¡¹ç›®å·²ä½¿ç”¨ï¼Œä¸€è‡´æ€§ |
| çŠ¶æ€ç®¡ç† | Zustand | è½»é‡ã€é¡¹ç›®å·²ä½¿ç”¨ |
| è™šæ‹Ÿæ»šåŠ¨ | `@tanstack/react-virtual` | é«˜æ€§èƒ½ï¼Œlist & grid ç»Ÿä¸€æ–¹æ¡ˆ |
| æ‹–æ‹½ | `@dnd-kit/core` | ç°ä»£ React DnD åº“ï¼Œæ”¯æŒå¯è®¿é—®æ€§ |
| æ ‘å½¢è§†å›¾ | `react-arborist` æˆ–è‡ªå»º | ä¾§è¾¹æ æ ‘ç»„ä»¶ |
| å›¾æ ‡ | `@mui/icons-material` | MUI é…å¥— |
| å›½é™…åŒ– | å†…ç½®ç®€å• i18nï¼ˆmessages å¯¹è±¡ï¼‰ | ä¸å¼•å…¥é¢å¤– i18n æ¡†æ¶ |
| æ‰“åŒ… | tsup | é¡¹ç›®ç»Ÿä¸€ |

### peerDependencies

```json
{
  "react": "^18.0.0 || ^19.0.0",
  "@mui/material": "^6.0.0",
  "@casfa/client": "workspace:*"
}
```

---

## 9. ç»„ä»¶åˆ†è§£

```
<CasfaExplorer>                    # é¡¶å±‚å®¹å™¨ï¼Œæä¾› Context
â”œâ”€â”€ <DepotSelector>                # depot åˆ—è¡¨ï¼ˆdepotId æœªæŒ‡å®šæ—¶æ˜¾ç¤ºï¼‰
â”œâ”€â”€ <ExplorerToolbar>              # å·¥å…·æ 
â”‚   â”œâ”€â”€ <NavigationButtons>        # â† â†’ â†‘
â”‚   â”œâ”€â”€ <Breadcrumb>               # é¢åŒ…å±‘ / è·¯å¾„è¾“å…¥
â”‚   â”œâ”€â”€ <SearchBox>                # æœç´¢è¿‡æ»¤
â”‚   â”œâ”€â”€ <ViewToggle>               # List / Grid åˆ‡æ¢
â”‚   â””â”€â”€ <ActionButtons>            # æ–°å»ºã€ä¸Šä¼ ã€ä¸‹è½½ã€åˆ é™¤
â”œâ”€â”€ <ExplorerBody>                 # ä¸»ä½“åŒºåŸŸ (flex row)
â”‚   â”œâ”€â”€ <TreeSidebar>              # å¯æŠ˜å æ–‡ä»¶å¤¹æ ‘
â”‚   â”œâ”€â”€ <FileList>                 # åˆ—è¡¨è§†å›¾ (MUI DataGrid æˆ–è‡ªå»ºè™šæ‹Ÿè¡¨æ ¼)
â”‚   â”œâ”€â”€ <FileGrid>                 # ç½‘æ ¼è§†å›¾ (è™šæ‹Ÿç½‘æ ¼)
â”‚   â””â”€â”€ <DetailPanel>              # è¯¦æƒ…/é¢„è§ˆé¢æ¿
â”œâ”€â”€ <ContextMenu>                  # å³é”®èœå• (MUI Menu)
â”œâ”€â”€ <UploadOverlay>                # æ‹–æ‹½ä¸Šä¼ è¦†ç›–å±‚
â”œâ”€â”€ <UploadProgress>               # ä¸Šä¼ è¿›åº¦é¢æ¿
â”œâ”€â”€ <ConfirmDialog>                # ç¡®è®¤å¯¹è¯æ¡†ï¼ˆåˆ é™¤ç­‰ï¼‰
â”œâ”€â”€ <RenameDialog>                 # é‡å‘½åå¯¹è¯æ¡†
â”œâ”€â”€ <CreateFolderDialog>           # æ–°å»ºæ–‡ä»¶å¤¹å¯¹è¯æ¡†
â”œâ”€â”€ <ConflictDialog>               # åç§°å†²çªå¤„ç†å¯¹è¯æ¡†
â”œâ”€â”€ <StatusBar>                    # åº•éƒ¨çŠ¶æ€æ 
â””â”€â”€ <ErrorSnackbar>                # å…¨å±€é”™è¯¯æç¤º
```

---

## 10. Hooks APIï¼ˆHeadless ä½¿ç”¨ï¼‰

é™¤äº†å®Œæ•´ UI ç»„ä»¶å¤–ï¼Œå¯¼å‡ºæ ¸å¿ƒ hooks ä¾›è‡ªå®šä¹‰ UIï¼š

```ts
// Depot åˆ—è¡¨
useDepots(client)                  â†’ { depots, isLoading, refresh }

// ç›®å½•æµè§ˆ
useDirectory(path)                 â†’ { items, isLoading, hasMore, loadMore, refresh }

// æ ‘å½¢æ•°æ®
useDirectoryTree(rootPath)         â†’ { tree, expandNode, collapseNode }

// æ–‡ä»¶æ“ä½œ
useFileOperations()                â†’ { upload, download, mkdir, rm, mv, cp, rename }

// é€‰æ‹©
useSelection()                     â†’ { selected, select, deselect, toggleSelect, selectAll, clearSelection }

// å‰ªè´´æ¿
useClipboard()                     â†’ { clipboard, cut, copy, paste, canPaste }

// å¯¼èˆª
useNavigation()                    â†’ { currentPath, navigate, goBack, goForward, goUp, canGoBack, canGoForward }

// æœç´¢
useSearch()                        â†’ { searchTerm, setSearchTerm, filteredItems }

// ä¸Šä¼ é˜Ÿåˆ—
useUploadQueue()                   â†’ { queue, addFiles, cancelUpload, retryUpload, progress }
```

---

## 11. ä¸ `@casfa/client` çš„é›†æˆ

### 11.1 éœ€è¦æ–°å¢çš„ Client æ–¹æ³•

å½“å‰ `@casfa/client` æ²¡æœ‰ `fs.*` æ–¹æ³•ï¼Œç»„ä»¶éœ€è¦ä»¥ä¸‹ APIï¼š

```ts
interface CasfaClientFs {
  stat(depotId: string, path: string): Promise<FsStatResult>;
  ls(depotId: string, path: string, opts?: { limit?: number; cursor?: string }): Promise<FsLsResult>;
  read(depotId: string, path: string): Promise<{ blob: Blob; contentType: string }>;
  write(depotId: string, path: string, data: Blob | ArrayBuffer): Promise<{ newRoot: string }>;
  mkdir(depotId: string, path: string): Promise<{ newRoot: string }>;
  rm(depotId: string, path: string): Promise<{ newRoot: string }>;
  mv(depotId: string, src: string, dst: string): Promise<{ newRoot: string }>;
  cp(depotId: string, src: string, dst: string): Promise<{ newRoot: string }>;
  rewrite(depotId: string, entries: RewriteEntry[], deletes?: string[]): Promise<{ newRoot: string }>;
  commitRoot(depotId: string, newRoot: string): Promise<void>;
}
```

### 11.2 Token ç®¡ç†

**ç»„ä»¶ä¸è´Ÿè´£ token ç®¡ç†**ã€‚`CasfaClient` å·²å†…ç½®è‡ªåŠ¨åˆ·æ–°æœºåˆ¶ï¼š
1. Client æ‹¦æˆª 401 å“åº”
2. ä½¿ç”¨ RT è°ƒç”¨ `/tokens/refresh`
3. è·å–æ–° AT åé‡è¯•åŸå§‹è¯·æ±‚
4. RT ä¹Ÿè¿‡æœŸæ—¶ï¼Œç»„ä»¶é€šè¿‡ client çš„é”™è¯¯å›è°ƒæ•è·å¹¶è§¦å‘ `onError({ type: "auth_expired" })`

ç»„ä»¶åªæ˜¯ client çš„æ¶ˆè´¹è€…ï¼Œä¸åˆ›å»ºä¹Ÿä¸é”€æ¯ clientã€‚å®¿ä¸»åº”ç”¨å…¨æƒç®¡ç† client ç”Ÿå‘½å‘¨æœŸã€‚

---

## 12. å®ç°è®¡åˆ’

è¯¦è§ [è¿­ä»£è®¡åˆ’](./iterations/README.md)ï¼Œå…± 5 ä¸ªè¿­ä»£ï¼š

| è¿­ä»£ | ä¸»é¢˜ | æ–‡æ¡£ |
|------|------|------|
| Iter 1 | éª¨æ¶ + åˆ—è¡¨æµè§ˆ | [iter-1-skeleton.md](./iterations/iter-1-skeleton.md) |
| Iter 2 | æ–‡ä»¶æ“ä½œ | [iter-2-file-ops.md](./iterations/iter-2-file-ops.md) |
| Iter 3 | å¯¼èˆª + å¸ƒå±€ | [iter-3-nav-layout.md](./iterations/iter-3-nav-layout.md) |
| Iter 4 | äº¤äº’å¢å¼º | [iter-4-interaction.md](./iterations/iter-4-interaction.md) |
| Iter 5 | CAS ç‰¹æ€§ + æ‰“ç£¨ | [iter-5-cas-polish.md](./iterations/iter-5-cas-polish.md) |

---

## 13. å¾…ç¡®è®¤é—®é¢˜

1. **å¤§æ–‡ä»¶ä¸Šä¼ **ï¼šå½“å‰ single-block é™åˆ¶ 4MBï¼Œæ˜¯å¦éœ€è¦åœ¨ç»„ä»¶å±‚æ”¯æŒ multi-blockï¼ˆs-node é“¾æ¥ï¼‰ä¸Šä¼ ï¼Ÿè¿˜æ˜¯å…ˆé™åˆ¶ 4MBï¼Œç­‰ server æ”¯æŒåå†æ‰©å±•ï¼Ÿ
2. **å®æ—¶åä½œ**ï¼šå¤šä¸ªç”¨æˆ·åŒæ—¶æ“ä½œåŒä¸€ depot æ—¶ï¼Œæ˜¯å¦éœ€è¦ WebSocket æ¨é€æ›´æ–°ï¼Ÿè¿˜æ˜¯æ‰‹åŠ¨åˆ·æ–°ï¼Ÿ
3. ~~**Depot é€‰æ‹©å™¨**~~ï¼šâœ… å·²ç¡®è®¤ â€” `depotId` å¯é€‰ï¼Œçœç•¥æ—¶ç»„ä»¶å†…ç½® depot é€‰æ‹©å™¨ã€‚
4. **ç¦»çº¿æ”¯æŒ**ï¼šæ˜¯å¦éœ€è¦æœ¬åœ°ç¼“å­˜ç›®å½•ç»“æ„ä»¥æ”¯æŒç¦»çº¿æµè§ˆï¼Ÿ
5. **æ–‡ä»¶ç¼–è¾‘**ï¼šæ˜¯å¦éœ€è¦åœ¨ç»„ä»¶å†…é›†æˆæ–‡æœ¬ç¼–è¾‘å™¨ï¼ˆå¦‚ Monacoï¼‰ï¼Œæ”¯æŒç›´æ¥ç¼–è¾‘å¹¶ä¿å­˜ï¼Ÿ

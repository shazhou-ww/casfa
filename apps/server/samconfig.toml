# CASFA SAM Deployment Configuration
#
# Usage:
#   sam deploy                          # Uses defaults from this file
#   sam deploy --guided                 # Interactive mode (first time)
#   sam deploy --parameter-overrides \
#     CognitoUserPoolId=us-east-1_XXXXX \
#     CognitoClientId=XXXXX
#
# Prerequisites:
#   1. AWS CLI configured (~/.aws/credentials)
#   2. SAM CLI installed (brew install aws-sam-cli)
#   3. Backend built (bun run build)

version = 0.1

[default.deploy.parameters]
stack_name = "casfa-prod"
resolve_s3 = true
s3_prefix = "casfa-sam"
region = "us-east-1"
# profile = "AdministratorAccess-914369185440"  # Commented out - use AWS_PROFILE env var or default credentials
capabilities = "CAPABILITY_IAM"
confirm_changeset = true
disable_rollback = false

parameter_overrides = [
  # ── Cognito ──
  "CognitoUserPoolId=us-east-1_gMTKxXOKo",
  "CognitoClientId=rrr40170csj0160ptr9lusi3k",
  "CognitoRegion=us-east-1",
  "CognitoHostedUiUrl=https://casfa-auth.auth.us-east-1.amazoncognito.com",

  # ── Domain ──
  "CustomDomainName=casfa.shazhou.me",
  "AcmCertificateArn=arn:aws:acm:us-east-1:914369185440:certificate/3d37ba1e-2d5a-4bc2-adf4-73642e1b02a0",
  "HostedZoneId=Z02459572I8BNRDEU4P1F",

  # ── Environment ──
  "StageName=prod",

  # ── Lambda ──
  "LambdaMemorySize=512",
  "LambdaTimeout=30",

  # ── Throttling ──
  "ApiThrottlingRate=100",
  "ApiThrottlingBurst=200",
  "WriteThrottlingRate=20",
  "WriteThrottlingBurst=50",
  "WafRateLimit=1000",

  # ── Server ──
  "CasNodeLimit=4194304",
  "CasMaxPayloadSize=10485760",
]

[default.build.parameters]
use_container = false

# ── Staging environment ──
[staging.deploy.parameters]
stack_name = "casfa-staging"
resolve_s3 = true
s3_prefix = "casfa-sam-staging"
region = "us-east-1"
# profile = "AdministratorAccess-914369185440"  # Commented out - use AWS_PROFILE env var or default credentials
capabilities = "CAPABILITY_IAM"
confirm_changeset = false

parameter_overrides = [
  # ── Cognito (shared User Pool, shared prod App Client) ──
  "CognitoUserPoolId=us-east-1_gMTKxXOKo",
  "CognitoClientId=rrr40170csj0160ptr9lusi3k",
  "CognitoRegion=us-east-1",
  "CognitoHostedUiUrl=https://casfa-auth.auth.us-east-1.amazoncognito.com",

  # ── Domain ──
  # "CustomDomainName=staging.casfa.shazhou.me",
  # "AcmCertificateArn=<staging-cert-arn>",
  # "HostedZoneId=Z02459572I8BNRDEU4P1F",

  # ── Environment ──
  "StageName=staging",

  # ── S3 (share prod CAS bucket) ──
  "ExternalCasBucketName=casfa-storage-prod-914369185440",

  # ── Lambda (match prod for realistic staging) ──
  "LambdaMemorySize=512",
  "LambdaTimeout=30",

  # ── Throttling ──
  "ApiThrottlingRate=50",
  "ApiThrottlingBurst=100",
  "WafRateLimit=500",

  # ── Server ──
  "CasNodeLimit=4194304",
  "CasMaxPayloadSize=10485760",
]

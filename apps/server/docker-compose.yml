services:
  # Persistent DynamoDB Local - for daily development (data retained across restarts)
  dynamodb:
    image: amazon/dynamodb-local:latest
    container_name: dynamodb
    user: root
    ports:
      - "8700:8000"
    command: ["-jar", "DynamoDBLocal.jar", "-sharedDb", "-dbPath", "/data"]
    volumes:
      - dynamodb-data:/data
    restart: unless-stopped

  # In-memory DynamoDB Local - for E2E tests (clean each run)
  dynamodb-test:
    image: amazon/dynamodb-local:latest
    container_name: dynamodb-test
    user: root
    ports:
      - "8701:8000"
    command: ["-jar", "DynamoDBLocal.jar", "-sharedDb", "-inMemory"]
    restart: "no"

  # Redis - for local development (persistent)
  redis:
    image: redis:7-alpine
    container_name: casfa-redis
    ports:
      - "6379:6379"
    volumes:
      - redis-data:/data
    restart: unless-stopped

  # Redis - for E2E tests (no persistence, isolated port)
  redis-test:
    image: redis:7-alpine
    container_name: casfa-redis-test
    ports:
      - "6380:6379"
    command: ["redis-server", "--save", ""]
    restart: "no"

volumes:
  dynamodb-data:
  redis-data:
